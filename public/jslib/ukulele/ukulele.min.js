/*! ukulelejs2 2015-06-22 */
function Ukulele(){"use strict";function a(a){var b=a.split(".");return b.shift(),b.join(".")}function b(a){return a.attr("uku-repeat")?!0:!1}function c(a){for(var b=a.parents(),c=0;c<b.length;c++){var d=b[c],e=$(d).attr("uku-repeat");if(e)return!0}return!1}this.controllersDefinition={},this.viewControllerArray=[],this.refreshHandler=void 0;var d,e={},f=this,g=function(){for(var a in f.controllersDefinition){for(var b=f.controllersDefinition[a],c=b.controllerInstance,h=e[a],i=0;i<b.boundAttrs.length;i++){var j=b.boundAttrs[i],k=j.attributeName;if(h){var l=ObjectUtil.getFinalValue(c,k),m=ObjectUtil.getFinalValue(h,k);if(!ObjectUtil.compare(m,l))for(var n=b.getBoundAttrByName(k),o=0;o<n.length;o++){var p=n[o];"repeat"===p.ukuTag?p.renderRepeat(c):null!==p.expression?p.renderExpression(c):p.renderAttribute(c),f.refreshHandler&&f.refreshHandler.call(null)}}}h=ObjectUtil.deepClone(c),delete e[a],e[a]=h}d=setTimeout(g,500)},h=function(){$("[uku-application]").each(function(){i($(this))})},i=function(d){function e(a){-1!==a.directText().search("{{")&&(b(a)||c(a)||g(a)),a.children().each(function(){e($(this))})}function g(b){var c=b.directText();if(c.search("{{")>-1&&c.search("}}")>-1){var d=c.slice(2,-2),e=l(d),f=e.controllerInstance;d=a(d),b.directText(ObjectUtil.getFinalValue(f,d));var g=new BoundAttribute(d,null,c,b);e.addBoundAttr(g)}}function h(b,c){var d=b.attr("uku-"+c),e=l(d),f=e.controllerInstance;d=a(d),b.attr(c,ObjectUtil.getFinalValue(f,d));var g=new BoundAttribute(d,c,null,b);e.addBoundAttr(g);var h=b[0].tagName;"INPUT"===h&&"value"===c&&b.change(function(){for(var a=d.split("."),c=f,e=0;e<a.length-1;e++)c=c[a[e]];c[a[a.length-1]]=b.val()})}function i(b,c){var d=b.attr("uku-"+c),e=l(d),f=e.controllerInstance,g=c.substring(2),h=/\(.*\)/,i=d.search(h),j=d.substring(0,i);j=a(j);var k=ObjectUtil.getAttributeFinalValue2(f,j),m=k.value,n=d.substring(i+1,d.length-1);n=n.split(","),b.bind(g,function(){for(var a=[],b=0;b<n.length;b++){var c=n[b],d=ObjectUtil.getFinalValue(f,c);a.push(d)}m.apply(k.parent,a.concat(arguments))})}function j(b){var c=b.attr("uku-repeat"),d=c.split(" in "),e=d[0],f=d[1],g=l(f),h=g.controllerInstance;f=a(f);var i=new BoundAttribute(f,"repeat",e,b);g.addBoundAttr(i),i.renderRepeat(h)}function k(a){var b=a.split(".")[0];return b?b:null}function l(a){var b=k(a),c=f.controllersDefinition[b];return c}var m=[],n=d.fuzzyFind("uku-");n&&m.push(n),d.find("*").each(function(){var a=$(this).fuzzyFind("uku-");a&&!c($(a))&&m.push(a)}),e(d);for(var o=0;o<m.length;o++)for(var p=m[o],q=0;q<p.attributes.length;q++){var r=p.attributes[q];if(r.nodeName.search("uku-")>-1){var s=r.nodeName.split("-")[1];"application"!==s&&(0===s.search("on")?b($(p))||c($(p))||i($(p),s):-1!==s.search("repeat")?j($(p)):b($(p))||c($(p))||h($(p),s))}}f.refreshHandler&&f.refreshHandler.call(null)};return{init:function(){$(document).ready(function(){h(),g()})},registerController:function(a,b){f.viewControllerArray.push({view:$(this),controller:b});var c=new ControllerModel(b);f.controllersDefinition[a]=c},dealWithElement:function(a,b){i(a),b&&g()},refreshHandler:function(a){f.refreshHandler=a}}}function BoundAttribute(a,b,c,d){"use strict";this.attributeName=a,this.ukuTag=b,this.expression=c,this.element=d,this.renderTemplate=void 0,this.parentElement=void 0,"repeat"===b&&(this.renderTemplate=d.prop("outerHTML"),this.parentElement=d.parent()),this.previousSiblings=void 0,this.nextSiblings=void 0}function ControllerModel(a){"use strict";this.controllerInstance=a,this.boundAttrs=[],this.addBoundAttr=function(a){this.boundAttrs.push(a)},this.getBoundAttrByName=function(a){for(var b=[],c=0;c<this.boundAttrs.length;c++){var d=this.boundAttrs[c];d.attributeName===a&&b.push(d)}return b}}function ObjectUtil(){"use strict"}!function(a){a.fn.directText=function(b){var c="";return this.each(function(){for(var a=this.childNodes,d=0;d<=a.length-1;d++){var e=a[d];if(3===e.nodeType){if(b||""===b||0===b)return void(e.nodeValue=b);c+=e.nodeValue}}}),a.trim(c)},a.fn.fuzzyFind=function(a){if(1===this.length){var b=this[0];if(b&&b.attributes)for(var c=0;c<b.attributes.length;c++){var d=b.attributes[c];if(d.nodeName.search(a)>-1)return b}}return null}}(jQuery),BoundAttribute.prototype.renderAttribute=function(a){var b=ObjectUtil.getFinalValue(a,this.attributeName);"value"===this.ukuTag?this.element.val(b):this.element.attr(this.ukuTag,b)},BoundAttribute.prototype.renderExpression=function(a){var b=ObjectUtil.getFinalValue(a,this.attributeName);this.element.directText(b)},BoundAttribute.prototype.renderRepeat=function(a){var b=ObjectUtil.getFinalValue(a,this.attributeName);if(b){var c=$(this.element).index();-1!==c&&(this.previousSiblings=$(this.element).prevAll(),this.nextSiblings=$(this.element).nextAll()),this.parentElement.children().remove();for(var d=0;d<this.previousSiblings.length;d++)this.parentElement.append(this.previousSiblings[d]);for(var e in b){var f=b[e],g=$(this.renderTemplate).removeAttr("uku-repeat");this.parentElement.append(g);var h=new Ukulele;h.registerController(this.expression,f),h.dealWithElement(g,!1)}for(var i=0;i<this.nextSiblings.length;i++)this.parentElement.append(this.nextSiblings[i])}},ObjectUtil.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},ObjectUtil.getType=function(a){var b=typeof a;return"object"===b&&ObjectUtil.isArray(a)?"array":b},ObjectUtil.getAttributeFinalValue=function(a,b){return ObjectUtil.getAttributeFinalValue2(a,b).value},ObjectUtil.getAttributeFinalValue2=function(a,b){var c,d=a,e=b.split(".");if(d)for(var f=0;f<e.length;f++){var g=e[f];if(c=d,d=d[g],void 0===d||null===d)break}return{value:d,parent:c}},ObjectUtil.getFinalValue=function(a,b){var c=/\(.*\)/,d=b.search(c);if(-1===d)return ObjectUtil.getAttributeFinalValue(a,b);var e=b.substring(0,d),f=ObjectUtil.getAttributeFinalValue2(a,e),g=f.value,h=b.substring(d+1,b.length-1);h=h.split(",");for(var i=[],j=0;j<h.length;j++){var k=h[j],l=ObjectUtil.getFinalValue(a,k);i.push(l)}return g=g.apply(f.parent,i)},ObjectUtil.compare=function(a,b){var c=ObjectUtil.getType(a),d=ObjectUtil.getType(b),e=!0;if(c!==d)return!1;switch(c){case"object":for(var f in a){var g=a[f],h=b[f],i=ObjectUtil.compare(g,h);if(!i){e=!1;break}}break;case"array":if(a.length===b.length)for(var j=0;j<a.length;j++){var k=a[j],l=b[j],m=ObjectUtil.compare(k,l);if(!m){e=!1;break}}else e=!1;break;case"function":e=a.toString()===b.toString();break;default:e=a===b}return e},ObjectUtil.deepClone=function(a){var b,c,d;if("object"!=typeof a||null===a)return a;if(a instanceof Array)for(b=[],c=0,d=a.length;d>c;c++)"object"==typeof a[c]&&null!==a[c]?b[c]=arguments.callee(a[c]):b[c]=a[c];else{b={};for(c in a)"object"==typeof a[c]&&null!==a[c]?b[c]=arguments.callee(a[c]):b[c]=a[c]}return b};