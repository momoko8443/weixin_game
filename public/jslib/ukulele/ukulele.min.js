/*! ukulelejs 2015-07-24 */
function Ukulele(){"use strict";function a(){for(var a in h){for(var b=h[a],d=b.controllerInstance,e=i[a],f=0;f<b.boundAttrs.length;f++){var g=b.boundAttrs[f],k=g.attributeName;if(e){"selecteditem"===g.ukuTag&&(k=k.split("|")[0]);var l=UkuleleUtil.getFinalValue(j,d,k),m=UkuleleUtil.getFinalValue(j,e,k);if(!ObjectUtil.compare(m,l)){k=g.attributeName;for(var n=b.getBoundAttrByName(k),o=0;o<n.length;o++){var p=n[o];"repeat"===p.ukuTag?p.renderRepeat(d):null!==p.expression?p.renderExpression(d):p.renderAttribute(d),j.refreshHandler&&j.refreshHandler.call(null)}}}}c(d,a)}}function b(){for(var a in h){var b=h[a],d=b.controllerInstance;c(d,a)}}function c(a,b){var c=ObjectUtil.deepClone(a);delete i[b],i[b]=c}function d(d){function g(a,b){function c(a){var e=$(d[a]),f=e.attr("load");if("false"===f)a++,a<d.length?c(a):b();else{var h=e.attr("src");e.load(h,function(){g(e,function(){a++,a<d.length?c(a):b()})})}}var d=a.find(".uku-include"),e=0;e<d.length?c(e):b()}function h(a){-1!==UkuleleUtil.searchUkuExpTag(a.directText())&&(UkuleleUtil.isRepeat(a)||UkuleleUtil.isInRepeat(a)||i(a)),a.children().each(function(){h($(this))})}function i(a){var b=a.directText();if(-1!==UkuleleUtil.searchUkuExpTag(b)){var c=b.slice(2,-2),d=new BoundAttribute(c,null,b,a,j),f=e(c);f.addBoundAttr(d),d.renderExpression(f.controllerInstance)}}function k(b,d){var f=b.attr("uku-"+d),g=b[0].tagName,h=f.split(".")[0],i=new BoundAttribute(f,d,null,b,j),k=e(f);k.addBoundAttr(i),i.renderAttribute(k.controllerInstance),(("INPUT"===g||"TEXTAREA"===g)&&"value"===d||"SELECT"===g&&"selecteditem"===d)&&b.change(function(e){c(k.controllerInstance,h);var i,j;if("SELECT"===g&&"selecteditem"===d){var l=f.split("|");j=l[0],i=l[1]}else j=f;j=UkuleleUtil.getFinalAttribute(j);for(var m=j.split("."),n=k.controllerInstance,o=0;o<m.length-1;o++)n=n[m[o]];if("SELECT"===g&&i){var p=b.find("option:selected").data("data-item");p=JSON.parse(p),n[m[m.length-1]]=p}else"INPUT"===g&&"checkbox"===b.attr("type")?n[m[m.length-1]]=b.is(":checked"):n[m[m.length-1]]=b.val();a()})}function l(b,d){var g,h=b.attr("uku-"+d),i=d.substring(2),j=e(h).controllerInstance,k=h.split(".");g="parent"===k[0]?k[1]:k[0],b.bind(i,function(){c(j,g),f(h,arguments),a()})}function m(a){var b=a.attr("uku-repeat"),c=b.split(" in "),d=c[0],f=c[1],g=e(f),h=g.controllerInstance,i=new BoundAttribute(f,"repeat",d,a,j);g.addBoundAttr(i),i.renderRepeat(h)}g(d,function(){var a=[],c=d.fuzzyFind("uku-");c&&a.push(c),d.find("*").each(function(){var b=$(this).fuzzyFind("uku-");b&&!UkuleleUtil.isInRepeat($(b))&&a.push(b)}),h(d);for(var e=0;e<a.length;e++)for(var f=a[e],g=0;g<f.attributes.length;g++){var i=f.attributes[g];if(UkuleleUtil.searchUkuAttrTag(i.nodeName)>-1){var n=i.nodeName.split("-");n.shift();var o=n.join("-");"application"!==o&&(0===o.search("on")?UkuleleUtil.isRepeat($(f))||UkuleleUtil.isInRepeat($(f))||l($(f),o):-1!==o.search("repeat")?m($(f)):UkuleleUtil.isRepeat($(f))||UkuleleUtil.isInRepeat($(f))||k($(f),o))}}j.refreshHandler&&j.refreshHandler.call(null),b()})}function e(a){var b=UkuleleUtil.getBoundModelInstantName(a),c=h[b];if(!c){var d=a.split("."),e=d[0];if("parent"===e&&j.parentUku)return d.shift(),a=d.join("."),j.parentUku.getControllerModelByName(a)}return c}function f(a,b){var c=e(a),d=c.controllerInstance,f=UkuleleUtil.getFinalValue(j,d,a,b);return f}function g(){$("[uku-application]").each(function(){d($(this))})}var h={},i={},j=this;this.refreshHandler=null,this.parentUku=null,this.init=function(){g()},this.registerController=function(a,b){var c=new ControllerModel(b);h[a]=c},this.dealWithElement=function(a){d(a)},this.loadIncludeElement=function(a){"false"===a.attr("load")&&(a.attr("load",!0),d(a.parent()))},this.getControllerModelByName=function(a){return e(a)},this.refresh=function(){a(),b()},this.getFinalValueByExpression=function(a){var b=this.getControllerModelByName(a).controllerInstance;return UkuleleUtil.getFinalValue(this,b,a)}}function BoundAttribute(a,b,c,d,e){"use strict";this.attributeName=a,this.ukuTag=b,this.expression=c,this.element=d,this.uku=e,this.renderTemplate=void 0,this.parentElement=void 0,"repeat"===b&&(this.renderTemplate=d.prop("outerHTML"),this.parentElement=d.parent()),this.previousSiblings=void 0,this.nextSiblings=void 0}function ControllerModel(a){"use strict";this.controllerInstance=a,this.boundAttrs=[],this.addBoundAttr=function(a){this.boundAttrs.push(a)},this.getBoundAttrByName=function(a){for(var b=[],c=0;c<this.boundAttrs.length;c++){var d=this.boundAttrs[c];d.attributeName===a&&b.push(d)}return b}}function ObjectUtil(){"use strict"}function UkuleleUtil(){"use strict"}!function(a){a.fn.directText=function(b){var c="";return this.each(function(){for(var a=this.childNodes,d=0;d<=a.length-1;d++){var e=a[d];if(3===e.nodeType){if(b||""===b||0===b)return void(e.nodeValue=b);c+=e.nodeValue}}}),a.trim(c)},a.fn.fuzzyFind=function(a){if(1===this.length){var b=this[0];if(b&&b.attributes)for(var c=0;c<b.attributes.length;c++){var d=b.attributes[c];if(d.nodeName.search(a)>-1)return b}}return null}}(jQuery),BoundAttribute.prototype.renderAttribute=function(a){var b,c=this.attributeName,d=this.element[0].tagName;if("selecteditem"===this.ukuTag&&"SELECT"===d){var e=this.attributeName.split("|");c=e[0],b=e[1]}var f=UkuleleUtil.getFinalValue(this.uku,a,c);if(-1!==this.ukuTag.search("data-item"))f=JSON.stringify(f),this.element.data("data-item",f);else if("selecteditem"===this.ukuTag&&"SELECT"===d){var g;g=b?f[b]:f,this.element.val(g)}else"checkbox"===this.element.attr("type")?this.element.attr("checked",f):"value"===this.ukuTag?this.element.val(f):this.element.attr(this.ukuTag,f)},BoundAttribute.prototype.renderExpression=function(a){var b=UkuleleUtil.getFinalValue(this.uku,a,this.attributeName);this.element.directText(b)},BoundAttribute.prototype.renderRepeat=function(a){var b=UkuleleUtil.getFinalValue(this.uku,a,this.attributeName);if(b){var c=$(this.element).index();-1!==c&&(this.previousSiblings=$(this.element).prevAll(),this.nextSiblings=$(this.element).nextAll()),this.parentElement.children().remove();for(var d=0;d<this.previousSiblings.length;d++)this.parentElement.append(this.previousSiblings[d]);for(var e in b){var f=b[e],g=$(this.renderTemplate).removeAttr("uku-repeat");this.parentElement.append(g);var h=new Ukulele;h.parentUku=this.uku,h.registerController(this.expression,f),h.dealWithElement(g)}for(var i=0;i<this.nextSiblings.length;i++)this.parentElement.append(this.nextSiblings[i]);if("OPTION"===this.element[0].tagName){var j=this.parentElement.attr("uku-selecteditem"),k=j.split("|");j=k[0],key=k[1];var l=this.uku.getFinalValueByExpression(j);key?this.parentElement.val(l[key]):this.parentElement.val(l)}}},ObjectUtil.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},ObjectUtil.getType=function(a){var b=typeof a;return"object"===b&&ObjectUtil.isArray(a)?"array":b},ObjectUtil.compare=function(a,b){var c=ObjectUtil.getType(a),d=ObjectUtil.getType(b),e=!0;if(c!==d)return!1;switch(c){case"object":for(var f in a){var g=a[f],h=b[f],i=ObjectUtil.compare(g,h);if(!i){e=!1;break}}break;case"array":if(a.length===b.length)for(var j=0;j<a.length;j++){var k=a[j],l=b[j],m=ObjectUtil.compare(k,l);if(!m){e=!1;break}}else e=!1;break;case"function":e=a.toString()===b.toString();break;default:e=a===b}return e},ObjectUtil.deepClone=function(a){var b,c,d;if("object"!=typeof a||null===a)return a;if(a instanceof Array)for(b=[],c=0,d=a.length;d>c;c++)"object"==typeof a[c]&&null!==a[c]?b[c]=arguments.callee(a[c]):b[c]=a[c];else{b={};for(c in a)"object"==typeof a[c]&&null!==a[c]?b[c]=arguments.callee(a[c]):b[c]=a[c]}return b},UkuleleUtil.getFinalAttribute=function(a){var b=a.split("."),c=b.shift();return"parent"===c?UkuleleUtil.getFinalAttribute(b.join(".")):b.join(".")},UkuleleUtil.searchUkuAttrTag=function(a){var b=/^uku\-.*/,c=a.search(b);return c},UkuleleUtil.searchUkuExpTag=function(a){var b=/^\{\{.*\}\}$/,c=a.search(b);return c},UkuleleUtil.searchUkuFuncArg=function(a){var b=/\(.*\)$/,c=a.search(b);return c},UkuleleUtil.isRepeat=function(a){return a.attr("uku-repeat")?!0:!1},UkuleleUtil.isInRepeat=function(a){for(var b=a.parents(),c=0;c<b.length;c++){var d=b[c],e=$(d).attr("uku-repeat");if(e)return!0}return!1},UkuleleUtil.getBoundModelInstantName=function(a){var b=a.split(".")[0];return b?b:null},UkuleleUtil.getAttributeFinalValue=function(a,b){var c=UkuleleUtil.getAttributeFinalValueAndParent(a,b),d=c.value;return d},UkuleleUtil.getAttributeFinalValueAndParent=function(a,b){var c,d=a;b=UkuleleUtil.getFinalAttribute(b);var e=b.split(".");if(""!==b&&d)for(var f=0;f<e.length;f++){var g=e[f];if(c=d,d=d[g],void 0===d||null===d)break}return{value:d,parent:c}},UkuleleUtil.getFinalValue=function(a,b,c,d){var e=UkuleleUtil.searchUkuFuncArg(c);if(-1===e)return UkuleleUtil.getAttributeFinalValue(b,c);var f=c.substring(0,e),g=UkuleleUtil.getAttributeFinalValueAndParent(b,f),h=g.value;if(void 0===h)return h;var i=c.substring(e+1,c.length-1);i=i.split(",");for(var j=[],k=0;k<i.length;k++){var l,m=i[k],n=a.getControllerModelByName(m);if(n&&n.controllerInstance){var o=n.controllerInstance;l=1===m.split(".").length?o:UkuleleUtil.getFinalValue(a,o,m)}else l=UkuleleUtil.getFinalValue(a,b,m);if(l!==b)j.push(l);else{var p=/\'.*\'/,q=m.search(p),r=/\".*\"/,s=m.search(r);-1!==q?(m=m.substring(1,m.length-1),j.push(m)):-1!==s?(m=m.substring(1,m.length-1),j.push(m)):j.push(l)}}return d&&j.concat(d),h=h.apply(g.parent,j)};